<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StudyWrecnh Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">

  <div class="flex min-h-screen">

    <!-- Sidebar -->
    <aside class="w-64 bg-white shadow-md p-6">
      <h2 class="text-2xl font-bold text-blue-600 mb-8">üìö StudyWrecnh</h2>
      <nav class="space-y-4 text-gray-700 font-medium">
        <a href="dashboard.html" class="block text-blue-600">Ask Questions</a>
        <a href="#" class="block hover:text-blue-500">Flashcards</a>
        <a href="#" class="block hover:text-blue-500">Career Paths</a>
        <a href="#" class="block hover:text-blue-500">Study Guides</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8">
      <h1 class="text-3xl font-bold mb-6">Welcome to Your Dashboard</h1>

      <!-- Ask a Question -->
      <section class="mb-10 bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4">Ask a Question</h2>
        <form id="questionForm" class="space-y-4">
          <input type="text" id="topic" placeholder="Topic" class="w-full p-2 border rounded" required />
          <textarea id="questionText" rows="4" placeholder="Your question..." class="w-full p-2 border rounded" required></textarea>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Submit</button>
        </form>
      </section>

      <!-- My Questions -->
      <section class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4">My Questions</h2>
        <ul id="myQuestionsList" class="space-y-2 list-disc list-inside text-gray-700"></ul>
      </section>
    </main>
  </div>

  <!-- Scripts -->
  <script>
    const token = localStorage.getItem('token');

    // üö® Redirect if not logged in
    if (!token) {
      alert('Please log in first.');
      window.location.href = '/auth.html';
    }

    // üßæ Load user's questions
    async function loadQuestions() {
      try {
        const res = await fetch('/api/questions/mine', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        const data = await res.json();

        if (!Array.isArray(data)) {
          console.error("‚ùå Expected array, got:", data);
          return;
        }

        const list = document.getElementById('myQuestionsList');
        list.innerHTML = '';

        data.forEach(q => {
          const item = document.createElement('li');
          item.className = "bg-gray-100 p-3 rounded shadow-sm";
          item.textContent = `${q.topic}: ${q.question}`;
          list.appendChild(item);
        });

      } catch (err) {
        console.error("‚ùå Error loading questions:", err);
      }
    }

    // ‚úçÔ∏è Submit question
    document.getElementById('questionForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const topic = document.getElementById('topic').value.trim();
      const question = document.getElementById('questionText').value.trim();

      if (!token || !topic || !question) {
        alert('All fields are required.');
        return;
      }

      try {
        const res = await fetch('/api/questions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ topic, question })
        });

        const data = await res.json();
        if (res.ok) {
          alert('‚úÖ Question submitted!');
          document.getElementById('questionForm').reset();
          loadQuestions();
        } else {
          alert(`‚ùå Error: ${data.error}`);
        }

      } catch (err) {
        console.error('‚ùå Submit failed:', err);
        alert('Submit failed.');
      }
    });

    // üîÅ Load on page load
    window.onload = loadQuestions;
  </script>

</body>
</html>
